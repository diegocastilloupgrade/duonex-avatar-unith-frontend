<div class="container">
  <h1>Cuestionario con Avatar</h1>

  <div class="forms">
    <form [formGroup]="userForm" class="card">
      <h2>Datos de usuario</h2>

      <label>
        Nombre
        <input formControlName="nombre" type="text" />
      </label>

      <label>
        Edad
        <input formControlName="edad" type="number" />
      </label>

      <label>
        Sexo
        <select formControlName="sexo">
          <option value="M">Masculino</option>
          <option value="F">Femenino</option>
          <option value="O">Otro</option>
        </select>
      </label>
    </form>

    <form [formGroup]="quizForm" class="card">
      <h2>Cuestionario</h2>

      <div formArrayName="questions">
        <div *ngFor="let qGroup of questions.controls; let i = index" [formGroupName]="i">
          <label>
            Pregunta {{ i + 1 }}
            <input formControlName="text" type="text" />
          </label>

          <label>
            Interpretación de esta pregunta
            <input formControlName="interpretation" type="text" />
          </label>

          <button type="button" (click)="removeQuestion(i)" *ngIf="questions.length > 1">
            Eliminar
          </button>
        </div>
      </div>

      <button type="button" (click)="addQuestion()">Añadir pregunta</button>

    </form>
  </div>

  <div class="avatar-section card">
    <h2>Avatar</h2>
    <label>
      Asistente
      <select [(ngModel)]="selectedAssistant">
        <option *ngFor="let a of assistants" [value]="a.key">
          {{ a.label }}
        </option>
      </select>
    </label>

    <button
      [disabled]="!canStart || !!unithSession"
      (click)="onStart()">
      {{ isConnecting ? 'Conectando...' : 'Comenzar' }}
    </button>

    <button
      type="button"
      [disabled]="!unithSession"
      (click)="onStop()">
      Desconectar
    </button>

    <!-- En lugar del video LiveKit, usamos un iframe con el publicUrl de Unith -->
    <div class="video-wrapper" *ngIf="unithSession">
      <iframe
        [src]="unithSession.publicUrl | safeUrl"
        width="100%"
        height="480"
        frameborder="0"
        allow="camera; microphone; autoplay; fullscreen">
      </iframe>
    </div>
  </div>

  <div class="card" *ngIf="debugRaw">
    <h2>Debug sesión</h2>
    <pre>{{ debugRaw | json }}</pre>
  </div>

  <div class="card" *ngIf="resultadoSimulado">
    <h2>Resultados del cuestionario (simulado)</h2>
    <pre>{{ resultadoSimulado }}</pre>
  </div>
</div>